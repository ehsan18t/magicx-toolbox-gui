# Windows Update Tweaks - Control Windows Update behavior and delivery

category:
  id: windows_update
  name: "Windows Update"
  description: "Control Windows Update behavior and delivery optimization"
  icon: "mdi:update"
  order: 7

tweaks:
  - id: disable_store_auto_updates
    name: "Disable Store Auto Updates"
    description: "Prevent Microsoft Store from automatically updating apps"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Apps will only update when you manually check for updates in the Store"
    options:
      - label: "Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 2
      - label: "Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 4

  - id: disable_peer_update_delivery
    name: "Disable P2P Update Delivery"
    description: "Disable Windows Update peer-to-peer delivery optimization"
    risk_level: low
    requires_reboot: false
    info: "Prevents Windows from downloading/uploading updates from/to other PCs"
    options:
      - label: "Disabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 0
      - label: "Enabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 3

  - id: disable_ms_products_auto_update
    name: "Disable MS Products Auto Update"
    description: "Disable automatic updates for other Microsoft products via Windows Update"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    options:
      - label: "Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 0
      - label: "Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 1

  - id: disable_driver_updates
    name: "Disable Driver Updates via Windows Update"
    description: "Prevent Windows Update from automatically installing driver updates"
    risk_level: medium
    requires_admin: true
    requires_reboot: false
    info: "Useful if you prefer to install drivers manually from manufacturer"
    options:
      - label: "Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 1
      - label: "Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 0

  - id: disable_windows_update_complete
    name: "Disable Windows Update (Complete)"
    description: "Completely disable the Windows Update service and automatic updates"
    risk_level: high
    requires_reboot: false
    requires_ti: true
    info: "Stops and disables the Windows Update service. Updates must be installed manually. Use with caution - security updates will not be installed automatically."
    options:
      - label: "Disabled"
        scheduler_changes:
          - task_path: "\\Microsoft\\Windows\\UpdateOrchestrator"
            task_name_pattern: "Schedule Scan|USO|MusNotification|Reboot|Refresh"
            action: disable
            ignore_not_found: true # Not all tasks exist on every system
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 4
        service_changes:
          - name: "wuauserv"
            startup: disabled
            skip_validation: true
          - name: "UsoSvc"
            startup: disabled
      - label: "Enabled"
        scheduler_changes:
          - task_path: "\\Microsoft\\Windows\\UpdateOrchestrator"
            task_name_pattern: "Schedule Scan|USO|MusNotification|Reboot|Refresh"
            action: enable
            ignore_not_found: true # Not all tasks exist on every system
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 2
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
