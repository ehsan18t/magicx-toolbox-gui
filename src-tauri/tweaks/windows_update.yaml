# Windows Update Tweaks - Control Windows Update behavior and delivery

category:
  id: windows_update
  name: "Windows Update"
  description: "Control Windows Update behavior and delivery optimization"
  icon: "mdi:update"
  order: 7

tweaks:
  - id: disable_store_auto_updates
    name: "Disable Store Auto Updates"
    description: "Prevent Microsoft Store from automatically updating apps"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Prevents Microsoft Store apps from updating automatically in the background.

      ## What Changes
      - Store apps won't update automatically
      - You control when updates are installed
      - Manual "Get updates" button still works

      ## Benefits
      - Control over app versions
      - Prevent unwanted UI changes
      - Reduce background bandwidth usage

      ## Recommendation
      Enable if you want full control over app updates. Remember to update manually for security.
    options:
      - label: "Auto Updates Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 2
      - label: "Auto Updates Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 4

  - id: disable_peer_update_delivery
    name: "Disable P2P Update Delivery"
    description: "Disable Windows Update peer-to-peer delivery optimization"
    risk_level: low
    requires_reboot: false
    info: |
      ## What This Does
      Disables peer-to-peer download of Windows updates.

      ## How P2P Works
      - Updates can download from other PCs on LAN or internet
      - Your PC can upload updates to other computers
      - Uses your bandwidth to help others update

      ## Privacy Consideration
      - With P2P, parts of updates come from unknown sources
      - Your bandwidth is used for Microsoft's CDN

      ## Recommendation
      Disable if you have metered internet or privacy concerns. Updates still download from Microsoft directly.
    options:
      - label: "P2P Delivery Disabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 0
      - label: "P2P Delivery Enabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 3

  - id: disable_ms_products_auto_update
    name: "Disable MS Products Auto Update"
    description: "Disable automatic updates for other Microsoft products via Windows Update"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Prevents Windows Update from updating other Microsoft products.

      ## Affected Products
      - Microsoft Office
      - Microsoft 365 apps
      - Silverlight, .NET Framework
      - Other Microsoft software

      ## When Disabled
      - Only Windows itself gets updated
      - Office and other MS apps need manual updates

      ## Recommendation
      Disable if you prefer to update Office and other MS products separately.
    options:
      - label: "MS Products Auto Update Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 0
      - label: "MS Products Auto Update Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 1

  - id: disable_driver_updates
    name: "Disable Driver Updates via Windows Update"
    description: "Prevent Windows Update from automatically installing driver updates"
    risk_level: medium
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Prevents Windows Update from automatically installing driver updates.

      ## Why Disable
      - Windows drivers can override optimized manufacturer drivers
      - GPU drivers from Windows Update are often outdated
      - Some drivers cause compatibility issues

      ## When to Keep Enabled
      - New PC setup (lets Windows find basic drivers)
      - You don't want to manage drivers manually

      ## Recommendation
      Recommended for gamers and power users who install drivers from manufacturers.
    options:
      - label: "Driver Updates Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 1
      - label: "Driver Updates Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 0

  - id: windows_update_mode
    name: "Windows Update Mode"
    description: "Control how Windows handles automatic updates"
    risk_level: high
    requires_reboot: false
    requires_admin: true
    requires_ti: true
    info: |
      ## What This Does
      Controls Windows Update behavior with different levels of automation.

      ## Options Explained
      - **Automatic Install**: Windows downloads and installs updates automatically (default behavior)
      - **Download Only**: Downloads updates but waits for you to install them
      - **Notify Only**: Checks for updates but asks before downloading
      - **Disabled (Complete)**: Completely disables Windows Update (requires TrustedInstaller)

      ## Security Warning
      Disabling or delaying updates can leave your system vulnerable to security threats. Only use restrictive settings if you understand the risks.

      ## Recommendation
      "Notify Only" offers a good balance of control and security for most users.
    options:
      - label: "Automatic Install (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 4
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Download Only"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 3
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Notify Only"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 2
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Disabled (Complete)"
        scheduler_changes:
          - task_path: "\\Microsoft\\Windows\\UpdateOrchestrator"
            task_name_pattern: "Schedule Scan|USO|MusNotification|Reboot|Refresh"
            action: disable
            ignore_not_found: true
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 4
        service_changes:
          - name: "wuauserv"
            startup: disabled
            skip_validation: true
          - name: "UsoSvc"
            startup: disabled

  - id: disable_auto_restart_after_update
    name: "Disable Auto Restart After Update"
    description: "Prevent Windows from automatically restarting after updates"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Prevents Windows from automatically restarting your PC after installing updates.

      ## Default Behavior
      - Windows schedules restarts during "inactive hours"
      - Can interrupt work if you leave PC unattended
      - May restart during downloads or long tasks

      ## When Disabled
      - You get notifications to restart
      - PC won't restart without your action
      - Updates wait until you choose to restart

      ## Recommendation
      Recommended for users who run long tasks or leave work open overnight.
    options:
      - label: "Auto Restart Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoRebootWithLoggedOnUsers"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MusNotification.exe"
            value_name: "Debugger"
            value_type: "REG_SZ"
            value: "%systemroot%\\System32\\taskkill.exe"
      - label: "Auto Restart Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoRebootWithLoggedOnUsers"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MusNotification.exe"
            value_name: "Debugger"
            action: delete_value

  - id: defer_feature_updates
    name: "Defer Feature Updates"
    description: "Delay feature updates (major Windows versions) by specified days"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Delays major Windows feature updates (like 23H2, 24H2) by the specified number of days.

      ## Why Defer
      - Wait for initial bugs to be patched
      - Avoid being an early adopter of new features
      - Give enterprise software time to certify compatibility

      ## Security Note
      - Security updates are NOT affected by this setting
      - Only major version upgrades are delayed

      ## Recommendation
      365 days is recommended for stability. Feature updates often have early issues.
    options:
      - label: "Defer 365 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 365
      - label: "Defer 180 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 180
      - label: "No Deferral (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 0

  - id: defer_quality_updates
    name: "Defer Quality Updates"
    description: "Delay quality updates (security patches) by specified days"
    risk_level: medium
    requires_admin: true
    requires_reboot: false
    info: |
      ## ⚠️ Caution: Security Trade-off

      ## What This Does
      Delays monthly security and quality updates by the specified number of days.

      ## Security Risk
      - Security patches fix known vulnerabilities
      - Delaying exposes you to exploits that are already public
      - Bad actors actively target known vulnerabilities

      ## Why Some Defer
      - Avoid rare buggy patches
      - Allow IT to test patches before deployment
      - 7 days is usually enough to catch major issues

      ## Recommendation
      7 days maximum if you choose to defer. Longer delays significantly increase risk.
    options:
      - label: "Defer 30 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 30
      - label: "Defer 7 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 7
      - label: "No Deferral (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 0

  - id: set_active_hours
    name: "Set Custom Active Hours"
    description: "Configure active hours to prevent update restarts during work time"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Sets the time range when Windows won't restart for updates.

      ## Options Explained
      - **Extended (6 AM - 11 PM)**: Maximum protection, 17-hour window
      - **Business (9 AM - 6 PM)**: Standard work hours, 9-hour window
      - **Auto**: Windows learns from your usage patterns

      ## How It Works
      - Updates can still install during active hours
      - Automatic restarts only happen OUTSIDE active hours
      - Maximum window is 18 hours

      ## Recommendation
      Extended hours recommended for home users. Business hours for predictable schedules.
    options:
      - label: "6 AM - 11 PM (Extended)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 6
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 23
      - label: "9 AM - 6 PM (Business)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 9
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 18
      - label: "Auto (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 8
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 17

  - id: disable_update_notifications
    name: "Disable Update Notifications"
    description: "Disable Windows Update restart notifications"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Hides the persistent restart notifications after updates are installed.

      ## What Gets Disabled
      - "Restart required" toast notifications
      - Restart reminder pop-ups
      - Update status in notification area

      ## What Still Happens
      - Updates still download and install
      - Action Center still shows update status
      - You just won't be nagged to restart

      ## Recommendation
      Enable if you find restart notifications annoying. Remember to restart periodically.
    options:
      - label: "Notifications Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetUpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "UpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 2
      - label: "Notifications Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetUpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "UpdateNotificationLevel"
            action: delete_value

  - id: disable_delivery_optimization_service
    name: "Disable Delivery Optimization Service"
    description: "Completely disable the Windows Update Delivery Optimization service"
    risk_level: low
    requires_admin: true
    requires_reboot: true
    info: |
      ## What This Does
      Completely disables the Delivery Optimization service.

      ## What Delivery Optimization Does
      - Downloads updates from Microsoft and other PCs
      - Can use your upload bandwidth for other PCs
      - Caches updates locally for faster LAN distribution

      ## When to Disable
      - Metered or limited internet connection
      - Privacy concerns about P2P downloads
      - You want updates only from Microsoft servers

      ## Note
      Microsoft Store may show slower download speeds with this disabled.

      ## Recommendation
      Safe to disable. Updates download directly from Microsoft instead.
    options:
      - label: "Delivery Optimization Disabled"
        registry_changes:
          - hive: HKLM
            key: "System\\CurrentControlSet\\Services\\DoSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 4
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DODownloadMode"
            value_type: "REG_DWORD"
            value: 0
      - label: "Delivery Optimization Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "System\\CurrentControlSet\\Services\\DoSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 2
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DODownloadMode"
            action: delete_value

  - id: limit_update_bandwidth
    name: "Limit Update Download Bandwidth"
    description: "Limit the bandwidth Windows Update can use for downloads"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: |
      ## What This Does
      Limits how much of your internet bandwidth Windows Update can consume.

      ## Options
      - **25% Limit**: Minimal impact on your browsing, slower updates
      - **50% Limit**: Balanced approach, updates at half speed
      - **75% Limit**: Faster updates, some browsing impact

      ## Background vs Foreground
      - Background: When you're actively using PC
      - Foreground: When Windows Update is open

      ## Recommendation
      25-50% limit for slower connections. Prevents updates from saturating your bandwidth.
    options:
      - label: "25% Bandwidth Limit"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            value_type: "REG_DWORD"
            value: 25
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            value_type: "REG_DWORD"
            value: 10
      - label: "50% Bandwidth Limit"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            value_type: "REG_DWORD"
            value: 50
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            value_type: "REG_DWORD"
            value: 25
      - label: "Unlimited (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            action: delete_value
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            action: delete_value
