# Windows Update Tweaks - Control Windows Update behavior and delivery

category:
  id: windows_update
  name: "Windows Update"
  description: "Control Windows Update behavior and delivery optimization"
  icon: "mdi:update"
  order: 7

tweaks:
  - id: disable_store_auto_updates
    name: "Disable Store Auto Updates"
    description: "Prevent Microsoft Store from automatically updating apps"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Apps will only update when you manually check for updates in the Store"
    options:
      - label: "Auto Updates Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 2
      - label: "Auto Updates Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\WindowsStore"
            value_name: "AutoDownload"
            value_type: "REG_DWORD"
            value: 4

  - id: disable_peer_update_delivery
    name: "Disable P2P Update Delivery"
    description: "Disable Windows Update peer-to-peer delivery optimization"
    risk_level: low
    requires_reboot: false
    info: "Prevents Windows from downloading/uploading updates from/to other PCs"
    options:
      - label: "P2P Delivery Disabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 0
      - label: "P2P Delivery Enabled"
        registry_changes:
          - hive: HKCU
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization"
            value_name: "SystemSettingsDownloadMode"
            value_type: "REG_DWORD"
            value: 3

  - id: disable_ms_products_auto_update
    name: "Disable MS Products Auto Update"
    description: "Disable automatic updates for other Microsoft products via Windows Update"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    options:
      - label: "MS Products Auto Update Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 0
      - label: "MS Products Auto Update Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\Windows\\CurrentVersion\\WindowsUpdate\\Services\\7971f918-a847-4430-9279-4a52d1efe18d"
            value_name: "RegisteredWithAU"
            value_type: "REG_DWORD"
            value: 1

  - id: disable_driver_updates
    name: "Disable Driver Updates via Windows Update"
    description: "Prevent Windows Update from automatically installing driver updates"
    risk_level: medium
    requires_admin: true
    requires_reboot: false
    info: "Useful if you prefer to install drivers manually from manufacturer"
    options:
      - label: "Driver Updates Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 1
      - label: "Driver Updates Enabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "ExcludeWUDriversInQualityUpdate"
            value_type: "REG_DWORD"
            value: 0

  - id: windows_update_mode
    name: "Windows Update Mode"
    description: "Control how Windows handles automatic updates"
    risk_level: high
    requires_reboot: false
    requires_admin: true
    requires_ti: true
    info: |
      ## What This Does
      Controls Windows Update behavior with different levels of automation.

      ## Options Explained
      - **Automatic Install**: Windows downloads and installs updates automatically (default behavior)
      - **Download Only**: Downloads updates but waits for you to install them
      - **Notify Only**: Checks for updates but asks before downloading
      - **Disabled (Complete)**: Completely disables Windows Update (requires TrustedInstaller)

      ## Security Warning
      Disabling or delaying updates can leave your system vulnerable to security threats. Only use restrictive settings if you understand the risks.

      ## Recommendation
      "Notify Only" offers a good balance of control and security for most users.
    options:
      - label: "Automatic Install (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 4
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Download Only"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 3
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Notify Only"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 2
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 3
        service_changes:
          - name: "wuauserv"
            startup: manual
            start_service: false
            skip_validation: true
          - name: "UsoSvc"
            startup: automatic
      - label: "Disabled (Complete)"
        scheduler_changes:
          - task_path: "\\Microsoft\\Windows\\UpdateOrchestrator"
            task_name_pattern: "Schedule Scan|USO|MusNotification|Reboot|Refresh"
            action: disable
            ignore_not_found: true
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "AUOptions"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoUpdate"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetDisableUXWUAccess"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "SYSTEM\\CurrentControlSet\\Services\\WaaSMedicSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 4
        service_changes:
          - name: "wuauserv"
            startup: disabled
            skip_validation: true
          - name: "UsoSvc"
            startup: disabled

  - id: disable_auto_restart_after_update
    name: "Disable Auto Restart After Update"
    description: "Prevent Windows from automatically restarting after updates"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Windows will notify you to restart but won't do it automatically"
    options:
      - label: "Auto Restart Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoRebootWithLoggedOnUsers"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MusNotification.exe"
            value_name: "Debugger"
            value_type: "REG_SZ"
            value: "%systemroot%\\System32\\taskkill.exe"
      - label: "Auto Restart Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU"
            value_name: "NoAutoRebootWithLoggedOnUsers"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\MusNotification.exe"
            value_name: "Debugger"
            action: delete_value

  - id: defer_feature_updates
    name: "Defer Feature Updates"
    description: "Delay feature updates (major Windows versions) by specified days"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Feature updates will be delayed, giving time for initial bugs to be fixed"
    options:
      - label: "Defer 365 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 365
      - label: "Defer 180 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 180
      - label: "No Deferral (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdates"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferFeatureUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 0

  - id: defer_quality_updates
    name: "Defer Quality Updates"
    description: "Delay quality updates (security patches) by specified days"
    risk_level: medium
    requires_admin: true
    requires_reboot: false
    info: "Security updates will be delayed. Use with caution."
    options:
      - label: "Defer 30 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 30
      - label: "Defer 7 Days"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 7
      - label: "No Deferral (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdates"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "DeferQualityUpdatesPeriodInDays"
            value_type: "REG_DWORD"
            value: 0

  - id: set_active_hours
    name: "Set Custom Active Hours"
    description: "Configure active hours to prevent update restarts during work time"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Windows won't restart for updates during active hours"
    options:
      - label: "6 AM - 11 PM (Extended)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 6
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 23
      - label: "9 AM - 6 PM (Business)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 9
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 18
      - label: "Auto (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursStart"
            value_type: "REG_DWORD"
            value: 8
          - hive: HKLM
            key: "Software\\Microsoft\\WindowsUpdate\\UX\\Settings"
            value_name: "ActiveHoursEnd"
            value_type: "REG_DWORD"
            value: 17

  - id: disable_update_notifications
    name: "Disable Update Notifications"
    description: "Disable Windows Update restart notifications"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Hides annoying restart notifications after updates"
    options:
      - label: "Notifications Disabled"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetUpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 1
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "UpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 2
      - label: "Notifications Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "SetUpdateNotificationLevel"
            value_type: "REG_DWORD"
            value: 0
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\WindowsUpdate"
            value_name: "UpdateNotificationLevel"
            action: delete_value

  - id: disable_delivery_optimization_service
    name: "Disable Delivery Optimization Service"
    description: "Completely disable the Windows Update Delivery Optimization service"
    risk_level: low
    requires_admin: true
    requires_reboot: true
    info: "Prevents Windows from sharing updates with other devices on your network or internet"
    options:
      - label: "Delivery Optimization Disabled"
        registry_changes:
          - hive: HKLM
            key: "System\\CurrentControlSet\\Services\\DoSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 4
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DODownloadMode"
            value_type: "REG_DWORD"
            value: 0
      - label: "Delivery Optimization Enabled (Default)"
        registry_changes:
          - hive: HKLM
            key: "System\\CurrentControlSet\\Services\\DoSvc"
            value_name: "Start"
            value_type: "REG_DWORD"
            value: 2
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DODownloadMode"
            action: delete_value

  - id: limit_update_bandwidth
    name: "Limit Update Download Bandwidth"
    description: "Limit the bandwidth Windows Update can use for downloads"
    risk_level: low
    requires_admin: true
    requires_reboot: false
    info: "Prevents Windows Update from saturating your internet connection"
    options:
      - label: "25% Bandwidth Limit"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            value_type: "REG_DWORD"
            value: 25
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            value_type: "REG_DWORD"
            value: 10
      - label: "50% Bandwidth Limit"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            value_type: "REG_DWORD"
            value: 50
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            value_type: "REG_DWORD"
            value: 25
      - label: "Unlimited (Default)"
        registry_changes:
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxForegroundBandwidth"
            action: delete_value
          - hive: HKLM
            key: "Software\\Policies\\Microsoft\\Windows\\DeliveryOptimization"
            value_name: "DOPercentageMaxBackgroundBandwidth"
            action: delete_value
